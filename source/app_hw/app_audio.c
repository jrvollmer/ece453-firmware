/**
 * @file app_audio.c
 * @author James Vollmer (jrvollmer@wisc.edu) - Team 01
 * @brief
 * Source file for audio system
 * 
 * @version 0.1
 * @date 2024-11-15
 * 
 * @copyright Copyright (c) 2024
 */
#include "app_audio.h"
#include "cy_pdl.h"
#include "cybsp.h"


/******************************************************************************/
/* Global Variables                                                           */
/******************************************************************************/
// Lookup table for a sine wave in unsigned format
uint32_t rawSineWaveLUT[] = {
    0x7FF, 0x880, 0x900, 0x97F, 0x9FC, 0xA78, 0xAF1, 0xB67, 0xBD9, 0xC48,
    0xCB2, 0xD18, 0xD79, 0xDD4, 0xE29, 0xE77, 0xEC0, 0xF01, 0xF3C, 0xF6F,
    0xF9A, 0xFBE, 0xFDA, 0xFEE, 0xFFA, 0xFFF, 0xFFA, 0xFEE, 0xFDA, 0xFBE,
    0xF9A, 0xF6F, 0xF3C, 0xF01, 0xEC0, 0xE77, 0xE29, 0xDD4, 0xD79, 0xD18,
    0xCB2, 0xC48, 0xBD9, 0xB67, 0xAF1, 0xA78, 0x9FC, 0x97F, 0x900, 0x880,
    0x7FF, 0x77E, 0x6FE, 0x67F, 0x602, 0x586, 0x50D, 0x497, 0x425, 0x3B6,
    0x34C, 0x2E6, 0x285, 0x22A, 0x1D5, 0x187, 0x13E, 0x0FD, 0x0C2, 0x08F,
    0x064, 0x040, 0x024, 0x010, 0x004, 0x000, 0x004, 0x010, 0x024, 0x040,
    0x064, 0x08F, 0x0C2, 0x0FD, 0x13E, 0x187, 0x1D5, 0x22A, 0x285, 0x2E6,
    0x34C, 0x3B6, 0x425, 0x497, 0x50D, 0x586, 0x602, 0x67F, 0x6FE, 0x77E
};
// A separate copy of the sine wave LUT to be adjusted
// as requested by the user (e.g. scale amplitude)
uint32_t transformedSineWaveLUT[] = {
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0
};
uint32_t soundByteSamplesLUT[N_TUNE_SAMPLES] = {0x73f,0x73f,0x73f,0x741,0x73f,0x741,0x73f,0x741,0x73f,0x741,0x741,0x741,0x73e,0x741,0x73d,0x743,0x73c,0x743,0x73c,0x745,0x73c,0x746,0x73c,0x747,0x73c,0x745,0x73b,0x745,0x73e,0x743,0x741,0x741,0x742,0x73b,0x744,0x739,0x74c,0x733,0x74f,0x72f,0x752,0x72a,0x75c,0x724,0x75c,0x71d,0x764,0x71a,0x766,0x718,0x769,0x715,0x76e,0x70b,0x7dd,0xd96,0x8e4,0x652,0x7a0,0xc63,0xdef,0xcad,0xd62,0xc4f,0xd0d,0xbd0,0xd0e,0x902,0x53c,0x52a,0x91f,0xcbd,0xb69,0xc0e,0xb3c,0xbb7,0xaef,0xb90,0xa04,0x4e5,0x3e7,0x632,0xb48,0xaf4,0xada,0xace,0xa83,0xaaa,0xa2c,0xab9,0x59d,0x336,0x423,0x925,0xc51,0xb8c,0xc10,0xb34,0xbd7,0xac3,0xc0b,0x7de,0x28c,0x28f,0x701,0xc2e,0xa8f,0xb74,0xa86,0xb0d,0xa57,0xae7,0x99d,0x30e,0x1a7,0x420,0xab3,0xaab,0xa73,0xa8a,0xa29,0xa6d,0x9be,0xaa5,0x4a8,0x138,0x232,0x847,0xb1f,0x9ad,0xa9c,0x98c,0xa67,0x944,0xaa0,0x6ed,0x15a,0x133,0x51e,0xa54,0x90b,0x9b7,0x912,0x97d,0x8fc,0x958,0x8a6,0x284,0x0ee,0x2f5,0x936,0x9a8,0x93a,0x983,0x902,0x983,0x8b4,0x9cf,0x470,0x0f4,0x1a0,0x70d,0xa45,0x8d3,0x9c8,0x8cb,0x9a6,0x896,0x9cf,0x6d6,0x176,0x105,0x49e,0xa1f,0x90a,0x98b,0x91e,0x907,0x871,0x8a3,0x85c,0x2b4,0x0f1,0x29b,0x860,0x938,0x8a1,0x914,0x87d,0x910,0x839,0x962,0x4c5,0x128,0x1a1,0x662,0x9da,0x874,0x95e,0x87a,0x939,0x853,0x954,0x713,0x1d2,0x13b,0x434,0x99f,0x8d0,0x92d,0x8d8,0x8f4,0x8d2,0x8be,0x8d7,0x33c,0x127,0x294,0x827,0x902,0x839,0x8d1,0x822,0x8cd,0x7e7,0x919,0x524,0x189,0x1c8,0x5f0,0x986,0x83d,0x90b,0x848,0x8e7,0x82e,0x8f4,0x750,0x24e,0x18f,0x407,0x92e,0x8b3,0x8d8,0x8b7,0x8a7,0x8b9,0x86f,0x8da,0x3c5,0x192,0x2a4,0x7c7,0x96d,0x880,0x927,0x86a,0x91a,0x830,0x95c,0x5c3,0x1d4,0x1fb,0x577,0x929,0x801,0x8b6,0x811,0x892,0x801,0x892,0x777,0x2c2,0x1de,0x3df,0x8b8,0x891,0x887,0x88f,0x85e,0x891,0x827,0x8c5,0x443,0x1f6,0x2c5,0x755,0x940,0x847,0x8f6,0x83b,0x8e5,0x809,0x91b,0x635,0x254,0x23e,0x57d,0x970,0x862,0x8f8,0x871,0x861,0x7cd,0x83a,0x786,0x337,0x233,0x3cc,0x840,0x86c,0x839,0x863,0x81a,0x865,0x7e7,0x8a1,0x4b9,0x25e,0x2f4,0x6ef,0x90d,0x811,0x8bf,0x80f,0x8ac,0x7ea,0x8d4,0x68b,0x2cc,0x297,0x547,0x923,0x841,0x8bc,0x84d,0x894,0x845,0x879,0x81a,0x3c2,0x27d,0x3e9,0x83f,0x846,0x7e8,0x834,0x7d3,0x838,0x7a6,0x875,0x520,0x2c9,0x327,0x695,0x8ce,0x7e2,0x880,0x7e6,0x86d,0x7ca,0x889,0x6cf,0x344,0x2f2,0x524,0x8cb,0x827,0x878,0x832,0x852,0x830,0x833,0x829,0x43d,0x2ee,0x3fb,0x7f8,0x8b1,0x839,0x891,0x821,0x88b,0x7f3,0x8c1,0x594,0x315,0x360,0x635,0x880,0x7a3,0x837,0x7ae,0x824,0x79d,0x834,0x6f6,0x3b1,0x344,0x504,0x868,0x802,0x82c,0x80a,0x80d,0x80a,0x7ed,0x81b,0x4ad,0x354,0x41c,0x797,0x889,0x7fd,0x864,0x7ef,0x85e,0x7c6,0x88f,0x60f,0x388,0x3a6,0x650,0x8d6,0x7fa,0x885,0x7f7,0x7df,0x76d,0x7e2,0x708,0x41a,0x397,0x4f9,0x805,0x7d9,0x7e3,0x7de,0x7cb,0x7e1,0x7ad,0x800,0x518,0x3b8,0x44c,0x742,0x85a,0x7c7,0x833,0x7c0,0x82b,0x7a0,0x853,0x659,0x3fa,0x3fd,0x623,0x892,0x7d8,0x848,0x7e2,0x830,0x7d6,0x82b,0x78b,0x48f,0x3df,0x527,0x7fd,0x79e,0x79e,0x7a8,0x78a,0x7af,0x76e,0x7d6,0x56e,0x41e,0x481,0x6f9,0x81f,0x796,0x7f8,0x794,0x7f0,0x77d,0x80e,0x698,0x468,0x457,0x608,0x847,0x7b9,0x809,0x7c1,0x7f2,0x7bd,0x7e8,0x799,0x4fa,0x452,0x535,0x7e4,0x813,0x7e9,0x808,0x7d4,0x806,0x7b5,0x829,0x5d3,0x466,0x4bb,0x6a8,0x7d5,0x752,0x7af,0x759,0x7aa,0x749,0x7bd,0x6b2,0x4cb,0x4a9,0x5f5,0x7f1,0x78c,0x7c3,0x796,0x7b1,0x794,0x7a1,0x78b,0x55c,0x4b6,0x55c,0x797,0x7e7,0x7af,0x7d6,0x79f,0x7d7,0x786,0x7fb,0x633,0x4d1,0x503,0x6db,0x831,0x7a5,0x805,0x77d,0x756,0x71e,0x76d,0x6c0,0x525,0x500,0x5f0,0x79e,0x75c,0x77e,0x764,0x773,0x768,0x766,0x770,0x5b9,0x519,0x58d,0x752,0x7b4,0x77b,0x7a4,0x77a,0x7a1,0x764,0x7b7,0x67f,0x534,0x565,0x6ae,0x7fe,0x774,0x7d4,0x778,0x7c7,0x775,0x7c2,0x737,0x578,0x575,0x5ae,0xc71,0xfff,0xe73,0xf1a,0xe0a,0xe9e,0xd36,0x6d1,0x3a4,0x577,0xc18,0xdab,0xd79,0xd7e,0xcf3,0xd2f,0xc60,0xd32,0x77b,0x2f6,0x2b1,0x891,0xc9d,0xc0a,0xca3,0xbb0,0xc58,0xb3d,0xc62,0x908,0x30c,0x150,0x50c,0xb46,0xb49,0xbd0,0xb29,0xb6c,0xaf2,0xb1f,0xa8a,0x3fc,0x0cc,0x235,0x891,0xa17,0x9df,0xa16,0x99b,0xa06,0x93d,0xa46,0x54d,0x10b,0x0e6,0x625,0xa3c,0x975,0xa35,0x957,0xa0d,0x917,0xa25,0x789,0x1db,0x072,0x398,0x99e,0x981,0x9f9,0x982,0x9b5,0x96e,0x978,0x954,0x35b,0x086,0x1a4,0x7f5,0x9da,0x98f,0x9d7,0x962,0x97e,0x7d2,0x911,0x4b5,0x0bb,0x0b8,0x552,0x94d,0x84b,0x920,0x850,0x900,0x82d,0x915,0x71d,0x1bf,0x096,0x348,0x8ef,0x8c2,0x90c,0x8cc,0x8d5,0x8c9,0x89e,0x8dc,0x364,0x0ca,0x1ca,0x775,0x96d,0x8bd,0x952,0x89b,0x946,0x856,0x990,0x594,0x147,0x10b,0x553,0x9aa,0x7c8,0x85e,0x7ba,0x847,0x7a9,0x855,0x6fb,0x1e3,0x10e,0x35c,0x89f,0x851,0x862,0x85a,0x839,0x860,0x802,0x895,0x39c,0x13d,0x235,0x745,0x92c,0x82e,0x8e6,0x822,0x8d9,0x7ec,0x91b,0x5c2,0x1ab,0x1ad,0x556,0x986,0x84f,0x906,0x860,0x8da,0x84e,0x8cb,0x7d5,0x29e,0x190,0x375,0x853,0x85f,0x83b,0x85c,0x819,0x861,0x7e4,0x8a0,0x43c,0x1c8,0x27f,0x6f7,0x91d,0x816,0x8cf,0x811,0x8bd,0x7e6,0x8ef,0x644,0x23e,0x217,0x52a,0x94c,0x847,0x8d9,0x856,0x8ad,0x84d,0x894,0x80e,0x340,0x201,0x39b,0x884,0x8df,0x890,0x8c5,0x874,0x87a,0x799,0x882,0x4aa,0x238,0x2af,0x695,0x8e7,0x7e6,0x897,0x7e9,0x884,0x7c8,0x8a9,0x695,0x2bc,0x271,0x4fe,0x8f7,0x830,0x896,0x83f,0x86e,0x83a,0x84f,0x825,0x3c7,0x26c,0x3af,0x81f,0x8ca,0x852,0x8ae,0x836,0x8ab,0x7fd,0x8ea,0x55c,0x297,0x2eb,0x698,0x93f,0x7bf,0x851,0x7b9,0x83f,0x7a4,0x858,0x6ce,0x32e,0x2c9,0x4d6,0x89b,0x80f,0x850,0x81a,0x82d,0x81b,0x80c,0x824,0x443,0x2d4,0x3cd,0x7be,0x8a8,0x81a,0x884,0x807,0x87f,0x7d8,0x8b8,0x5c8,0x30b,0x33b,0x652,0x908,0x810,0x8ab,0x817,0x88e,0x803,0x892,0x761,0x397,0x312,0x4ba,0x82c,0x7e2,0x7fb,0x7eb,0x7e1,0x7ef,0x7c0,0x80c,0x4aa,0x336,0x3ec,0x75a,0x877,0x7dd,0x84f,0x7d3,0x849,0x7ad,0x879,0x61c,0x379,0x38b,0x618,0x8c3,0x7e9,0x86e,0x7f3,0x853,0x7e6,0x851,0x780,0x417,0x36d,0x4e1,0x862,0x84b,0x843,0x845,0x826,0x7d9,0x76b,0x7e6,0x501,0x395,0x411,0x700,0x836,0x7a0,0x80f,0x79d,0x809,0x783,0x831,0x65b,0x3e5,0x3d9,0x5e7,0x873,0x7c6,0x82a,0x7d0,0x811,0x7cb,0x806,0x792,0x486,0x3d4,0x4ef,0x80d,0x82b,0x806,0x824,0x7ec,0x825,0x7c7,0x84f,0x58d,0x3ef,0x449,0x71f,0x877,0x75b,0x7d3,0x765,0x7cb,0x753,0x7e4,0x689,0x44e,0x42e,0x5cc,0x81f,0x79b,0x7e6,0x7a8,0x7d0,0x7a5,0x7c5,0x793,0x4f6,0x436,0x50a,0x7b7,0x804,0x7cc,0x7fa,0x7bb,0x7fb,0x79e,0x823,0x5eb,0x45a,0x49b,0x6dc,0x85d,0x7be,0x828,0x7bf,0x81a,0x7ac,0x828,0x706,0x4a2,0x479,0x5b1,0x7be,0x768,0x794,0x772,0x786,0x778,0x77c,0x779,0x550,0x495,0x52d,0x763,0x7d0,0x78e,0x7c4,0x786,0x7c3,0x76d,0x7e5,0x632,0x4bf,0x4e7,0x6ad,0x81b,0x792,0x7ec,0x796,0x7e0,0x789,0x7ea,0x71f,0x517,0x4cf,0x5ec,0x803,0x7cb,0x7de,0x7d0,0x7ba,0x744,0x732,0x74e,0x598,0x4f0,0x556,0x71a,0x791,0x754,0x784,0x754,0x784,0x745,0x7a2,0x66b,0x51e,0x53a,0x689,0x7d9,0x762,0x7b5,0x76e,0x7ab,0x763,0x7ac,0x729,0x582,0x531,0x601,0x7bd,0x7a1,0x7af,0x79e,0x7a7,0x795,0x79e,0x798,0x635,0x508,0x5ed,0x6a3,0xafa,0xfba,0xed3,0xeb8,0xeba,0x901,0x4c0,0x976,0xcf1,0xc12,0xd0f,0xdba,0xd43,0xd67,0x751,0x38f,0x952,0xd9b,0xc70,0xb4e,0xaac,0xb1e,0xc40,0x608,0x2c6,0x8f9,0xcbe,0xbcd,0xc00,0xbb6,0xaa2,0x97e,0x34f,0x1e6,0x8f5,0xc14,0xb41,0xb71,0xb1c,0xb26,0xab0,0x364,0x048,0x69b,0x9f8,0x9da,0xa0e,0x9ab,0x9f2,0x917,0x2c5,0x19a,0x7e5,0x97b,0x85d,0x91f,0x977,0xa00,0x8af,0x26a,0x1be,0x84d,0xa38,0x98d,0x941,0x829,0x8d5,0x806,0x226,0x1e9,0x894,0xa1e,0x982,0x9c3,0x960,0x98c,0x6df,0x06e,0x19d,0x8da,0xa14,0x96c,0x9d5,0x91d,0x8d2,0x6a6,0x0de,0x18e,0x771,0x87f,0x872,0x8d8,0x84d,0x8ff,0x684,0x0d8,0x287,0x872,0x8c3,0x809,0x86a,0x845,0x93c,0x64e,0x0d3,0x301,0x8c0,0x916,0x8ce,0x8e9,0x803,0x8ad,0x5b3,0x0cd,0x37e,0x908,0x922,0x8e8,0x915,0x8a7,0x950,0x557,0x01e,0x36d,0x93f,0x87b,0x7d2,0x827,0x7b8,0x860,0x4c1,0x06a,0x3d3,0x87f,0x83d,0x83e,0x847,0x80a,0x882,0x4a9,0x08f,0x46f,0x8c8,0x863,0x874,0x86d,0x842,0x89b,0x476,0x0b7,0x4f2,0x8fd,0x87d,0x89c,0x886,0x86a,0x8a6,0x435,0x0e1,0x56b,0x927,0x88c,0x8c0,0x895,0x88d,0x8a2,0x3ee,0x113,0x592,0x8ae,0x818,0x855,0x822,0x834,0x81c,0x3a0,0x164,0x609,0x8e0,0x837,0x884,0x83c,0x865,0x81a,0x376,0x1a3,0x676,0x8fd,0x84f,0x8a4,0x84e,0x88d,0x808,0x340,0x1e3,0x6db,0x90f,0x862,0x8bb,0x85c,0x8aa,0x7f0,0x308,0x226,0x734,0x91d,0x86a,0x8d6,0x837,0x82f,0x754,0x2d1,0x276,0x71f,0x896,0x807,0x85e,0x7fa,0x866,0x741,0x2bb,0x2d1,0x77b,0x8ad,0x828,0x87c,0x814,0x88c,0x725,0x2a4,0x324,0x7c7,0x8b9,0x841,0x891,0x826,0x8a8,0x6fb,0x287,0x377,0x80c,0x8be,0x858,0x89e,0x836,0x8bd,0x6ca,0x26f,0x3c2,0x84e,0x865,0x7d5,0x826,0x7c0,0x848,0x645,0x27d,0x415,0x806,0x844,0x80e,0x83b,0x7eb,0x864,0x62b,0x280,0x474,0x840,0x854,0x82e,0x84f,0x808,0x878,0x600,0x281,0x4d1,0x86e,0x85e,0x846,0x85c,0x81d,0x884,0x5d0,0x284,0x527,0x893,0x862,0x85a,0x864,0x82e,0x88a,0x590,0x296,0x545,0x81c,0x7e1,0x7ea,0x7e8,0x7ca,0x807,0x53a,0x2c9,0x5a3,0x850,0x7f8,0x812,0x7ff,0x7f1,0x815,0x51d,0x2ec,0x5f9,0x871,0x80a,0x82f,0x80f,0x80f,0x817,0x4f3,0x30e,0x64a,0x889,0x815,0x845,0x818,0x828,0x810,0x4c9,0x330,0x690,0x89c,0x818,0x85f,0x7d1,0x7a6,0x786,0x485,0x372,0x684,0x81e,0x7b0,0x7ea,0x7b3,0x7de,0x789,0x47d,0x3ab,0x6d8,0x838,0x7cc,0x808,0x7ca,0x800,0x783,0x465,0x3df,0x719,0x84d,0x7e2,0x81e,0x7d8,0x81d,0x772,0x44b,0x414,0x759,0x854,0x7f1,0x82c,0x7e8,0x831,0x75d,0x431,0x447,0x788,0x7e3,0x773,0x7b8,0x770,0x7c3,0x6e2,0x436,0x48c,0x759,0x7e3,0x7a2,0x7d0,0x796,0x7e3,0x6e1,0x436,0x4cf,0x790,0x7f9,0x7bd,0x7e7,0x7ab,0x7fd,0x6cf,0x431,0x50d,0x7bf,0x804,0x7d1,0x7f8,0x7be,0x80f,0x6ba,0x42e,0x547,0x7e3,0x80c,0x7e5,0x805,0x7cb,0x821,0x693,0x430,0x563,0x777,0x787,0x773,0x78b,0x763,0x7a2,0x641,0x456,0x5ab,0x7a9,0x7a2,0x798,0x7a5,0x783,0x7bc,0x638,0x46c,0x5e9,0x7cf,0x7b1,0x7b0,0x7b6,0x79f,0x7cc,0x624,0x47f,0x625,0x7eb,0x7bf,0x7ca,0x7c3,0x7b3,0x7d8,0x613,0x48d,0x659,0x800,0x7c5,0x7d8,0x75c,0x733,0x756,0x5cc,0x4c7,0x64d,0x790,0x752,0x773,0x75b,0x769,0x762,0x5e0,0x4e3,0x694,0x7a5,0x779,0x788,0x77d,0x781,0x77d,0x5d1,0x50c,0x6c7,0x7c1,0x78a,0x79b,0x791,0x790,0x78b,0x5b7,0x53c,0x6d8,0x7ee,0x76e,0x7d8,0x767,0x7e0,0x737,0x609,0x4c9,0x89e,0xf70,0xefe,0xec7,0xe96,0xe18,0x75d,0x35d,0x9b3,0xe36,0xdbb,0xdb7,0xd59,0xd49,0xcaf,0x59c,0x26a,0x8e1,0xd42,0xc88,0xcd0,0xc33,0xc7b,0xb67,0x451,0x1a8,0x892,0xc6c,0xbc6,0xc09,0xb7c,0xbd1,0xa7d,0x33d,0x144,0x85e,0xbd8,0xb34,0xb76,0xaed,0xb5a,0x9b8,0x22b,0x113,0x7da,0xa58,0x9bb,0xa10,0x988,0xa0f,0x82f,0x16f,0x14c,0x810,0xa36,0x9a0,0x9f4,0x967,0xa08,0x7c1,0x108,0x185,0x84b,0xa16,0x993,0x9dd,0x951,0x9f5,0x752,0x0ae,0x1d4,0x886,0x9fc,0x982,0x9d0,0x944,0x9f1,0x6e7,0x067,0x224,0x8c1,0x9e8,0x983,0x9c1,0x864,0x8be,0x5a7,0x000,0x299,0x84c,0x8d4,0x88f,0x8c5,0x85a,0x900,0x56d,0x018,0x31d,0x8a7,0x8e7,0x8c1,0x8e3,0x888,0x918,0x528,0x01f,0x3a4,0x8f1,0x8f6,0x8e9,0x8f4,0x8ac,0x921,0x4e3,0x029,0x420,0x927,0x8fc,0x905,0x8f6,0x8cc,0x91c,0x49a,0x028,0x4b3,0x8d8,0x7d9,0x81f,0x7f8,0x7ee,0x81f,0x3af,0x06b,0x50e,0x8b9,0x821,0x85e,0x82d,0x832,0x839,0x389,0x0b5,0x59a,0x8f2,0x849,0x88f,0x850,0x869,0x843,0x353,0x0fb,0x61a,0x91c,0x864,0x8b8,0x868,0x898,0x83a,0x31e,0x13c,0x686,0x937,0x877,0x8d6,0x875,0x8bc,0x820,0x2dd,0x186,0x690,0x8b0,0x80c,0x866,0x80a,0x85f,0x797,0x2b1,0x1e7,0x6fb,0x8d7,0x82f,0x890,0x826,0x88f,0x781,0x28d,0x23f,0x75f,0x8ea,0x84d,0x8ab,0x83b,0x8b2,0x764,0x268,0x294,0x7b5,0x8f4,0x864,0x8c0,0x849,0x8d1,0x733,0x244,0x2e3,0x802,0x8f3,0x87f,0x8b7,0x7d3,0x855,0x69d,0x22e,0x33c,0x7cc,0x876,0x814,0x85d,0x7f5,0x880,0x682,0x22d,0x3a0,0x818,0x887,0x839,0x875,0x813,0x89c,0x659,0x222,0x402,0x856,0x891,0x856,0x885,0x82b,0x8b0,0x628,0x21b,0x45b,0x889,0x894,0x86e,0x88c,0x841,0x8b6,0x5f0,0x20e,0x4c4,0x878,0x7ff,0x800,0x80c,0x7d8,0x83c,0x57f,0x242,0x4f3,0x85c,0x823,0x825,0x829,0x7fe,0x850,0x558,0x25b,0x559,0x886,0x835,0x843,0x83b,0x81c,0x85b,0x52c,0x274,0x5b4,0x8a8,0x83f,0x85c,0x845,0x835,0x859,0x4f5,0x28e,0x605,0x8c1,0x843,0x872,0x847,0x850,0x840,0x49f,0x2bb,0x60b,0x83c,0x7cd,0x7fc,0x7d4,0x7e6,0x7cc,0x47f,0x2f7,0x664,0x863,0x7e6,0x821,0x7ea,0x80f,0x7cb,0x461,0x32c,0x6b8,0x87b,0x7fc,0x83c,0x7fb,0x82e,0x7c1,0x440,0x35d,0x700,0x88a,0x80c,0x850,0x805,0x84a,0x7aa,0x41d,0x38c,0x748,0x88b,0x827,0x82c,0x77e,0x7d5,0x720,0x3ff,0x3d4,0x71d,0x812,0x7b2,0x7f0,0x7a9,0x7fa,0x71d,0x3f6,0x41b,0x762,0x829,0x7d1,0x80a,0x7c3,0x81a,0x70e,0x3e9,0x460,0x79e,0x837,0x7e8,0x81d,0x7d4,0x830,0x6f7,0x3dc,0x49e,0x7ce,0x83f,0x7fb,0x829,0x7e2,0x83f,0x6d8,0x3c9,0x4e5,0x79e,0x7ab,0x78e,0x7aa,0x779,0x7ca,0x66f,0x3ec,0x514,0x7ac,0x7d0,0x7ae,0x7cb,0x799,0x7ea,0x660,0x3f9,0x55e,0x7da,0x7e1,0x7cb,0x7df,0x7b1,0x7fd,0x64b,0x404,0x59e,0x7fe,0x7ed,0x7e2,0x7ee,0x7c6,0x808,0x62d,0x40e,0x5db,0x81c,0x7f1,0x7f6,0x7f1,0x7dc,0x7fb,0x5db,0x42a,0x5e1,0x7a0,0x776,0x780,0x780,0x770,0x796,0x5cc,0x456,0x626,0x7cd,0x790,0x7a6,0x797,0x794,0x7a3,0x5c3,0x474,0x669,0x7e8,0x7a6,0x7be,0x7aa,0x7ae,0x7ad,0x5b3,0x48f,0x6a1,0x7fd,0x7b6,0x7d0,0x7b9,0x7c1,0x7b1,0x597,0x4b1,0x6cc,0x813,0x7b5,0x7b6,0x681,0x504,0x534,0x53a,0x550,0x55f,0x56f,0x582,0x58f,0x5a0,0x5a9,0x5bb,0x5c6,0x5d6,0x5df,0x5ef,0x5f7,0x605,0x60c,0x619,0x620,0x62c,0x635,0x63f,0x646,0x650,0x657,0x660,0x667,0x66f,0x675,0x67c,0x684,0x68a,0x690,0x694,0x69b,0x6a1,0x6a8,0x6ad,0x6b3,0x6b6,0x6ba,0x6bf,0x6c4,0x6c8,0x6cc,0x6d0,0x6d4,0x6d7,0x6dc,0x6df,0x6e2,0x6e5,0x6e8,0x6eb,0x6ee,0x6f0,0x6f3,0x6f6,0x6f8,0x6fb,0x6fd,0x6ff,0x702,0x704,0x705,0x707,0x709,0x70b,0x70d,0x70f,0x711,0x712,0x714,0x715,0x717,0x718,0x719,0x71b,0x71c,0x71d,0x71e,0x720,0x721,0x722,0x723,0x724,0x725,0x726,0x727,0x727,0x728,0x729,0x72a,0x72b,0x72b,0x72c,0x72d,0x72d,0x72e,0x72f,0x72f,0x730,0x730,0x731,0x731,0x732,0x732,0x733,0x733,0x734,0x734,0x734,0x735,0x735,0x736,0x736,0x736,0x737,0x737,0x737,0x738,0x738,0x738,0x738,0x739,0x739,0x739,0x739,0x73a,0x73a,0x73a,0x73a,0x73a,0x73b,0x73b,0x73b,0x73b,0x73b,0x73b,0x73c,0x73c,0x73c,0x73c,0x73c,0x73c,0x73c,0x73c,0x73d,0x73d,0x73d,0x73d,0x73d,0x73d,0x73d,0x73d,0x73d,0x73e,0x73d,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73e,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f,0x73f};


/*******************************************************************************
 * Function Prototypes
 ********************************************************************************/
static void app_audio_vdac_init(void);
static void app_audio_dma_init(void);


/*******************************************************************************
 * Function Definitions
 *******************************************************************************/
/**
 * @brief  Play a tone on the speaker
 * 
 * @param param
 * Unused
 */
void app_audio_play_tone(uint32_t amplitude, uint32_t frequency)
{
    // Update ampltiude
    uint32_t amp_range = MAX_AMP_mDB - MIN_AMP_mDB;
    for (int i = 0; i < N_TONE_SAMPLES; i++)
    {
        transformedSineWaveLUT[i] = ((amplitude * rawSineWaveLUT[i]) / amp_range);
    }

    // Disable the descriptors for the tune
    Cy_DMA_Disable(cpuss_0_dw1_0_chan_1_HW);
    Cy_DMA_Channel_Disable(cpuss_0_dw1_0_chan_1_HW, cpuss_0_dw1_0_chan_1_CHANNEL);

    // Update frequency
    uint32_t divider = (1000000 / frequency) - 1;
    (void)Cy_SysClk_PeriphDisableDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM);
    (void)Cy_SysClk_PeriphSetFracDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM, divider, 0U);
    (void)Cy_SysClk_PeriphEnableDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM);

    // Enable the descriptor for the tone
    Cy_DMA_Channel_Enable(cpuss_0_dw1_0_chan_0_HW, cpuss_0_dw1_0_chan_0_CHANNEL);
    Cy_DMA_Enable(cpuss_0_dw1_0_chan_0_HW);
}


/**
 * @brief  Play a tune on the speaker
 * 
 * @param param
 * Unused
 */
void app_audio_play_tune(void) // TODO Add a parameter to choose the tune (need to configure divider and probably some chaining/sample count parameters in the DMA channel)
{
    // Disable the descriptor for the tone
    Cy_DMA_Disable(cpuss_0_dw1_0_chan_0_HW);
    Cy_DMA_Channel_Disable(cpuss_0_dw1_0_chan_0_HW, cpuss_0_dw1_0_chan_0_CHANNEL);

    // Set divider so that the tune is replayed at the sample rate used to process the original audio file ((max_clock_rate_hz / sample_rate_hz) - 1)
    (void)Cy_SysClk_PeriphDisableDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM);
    (void)Cy_SysClk_PeriphSetFracDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM, 9999U, 0U);
    (void)Cy_SysClk_PeriphEnableDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM);

    // Enable the descriptors for the tune
    Cy_DMA_Channel_Enable(cpuss_0_dw1_0_chan_1_HW, cpuss_0_dw1_0_chan_1_CHANNEL);
    Cy_DMA_Enable(cpuss_0_dw1_0_chan_1_HW);
}


/**
 * @brief Initialize CTDAC for speaker
 * 
 * @param void
 * @return void
 */
static void app_audio_vdac_init(void)
{
    // Initialize and enable the analog reference block (AREF)
    Cy_SysAnalog_Init(&Cy_SysAnalog_Fast_Local);
    Cy_SysAnalog_Enable();

    // Configure CTDAC for VDDA reference and buffered output
    Cy_CTDAC_FastInit(CTDAC0, &Cy_CTDAC_Fast_VddaRef_BufferedOut);

    // Enable the CTDAC hardware block
    Cy_CTDAC_Enable(CTDAC0);

    // Set the clock divider to control the frequency of the DMA/CTDAC updates
    // (and the corresponding frequency of the sine wave). Start at nominal divider
    uint32_t currDiv = Cy_SysClk_PeriphGetAssignedDivider(PCLK_PASS_CLOCK_CTDAC);
    uint32_t newDiv = _VAL2FLD(PERI_DIV_CMD_TYPE_SEL, peri_0_div_24_5_0_HW) |
                      _VAL2FLD(PERI_DIV_CMD_DIV_SEL, peri_0_div_24_5_0_NUM);
    if (currDiv != newDiv)
    {
        (void)Cy_SysClk_PeriphDisableDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM);
        (void)Cy_SysClk_PeriphSetFracDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM, 199UL, 0UL);
        (void)Cy_SysClk_PeriphAssignDivider(PCLK_PASS_CLOCK_CTDAC, peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM);
        (void)Cy_SysClk_PeriphEnableDivider(peri_0_div_24_5_0_HW, peri_0_div_24_5_0_NUM);
    }
}


/**
 * @brief  Initialize DMA for injecting audio samples into the CTDAC
 * 
 * @return void
 */
static void app_audio_dma_init(void)
{
    cy_en_dma_status_t dma_init_status;

    // Initialize descriptors and channel
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_0,
        &cpuss_0_dw1_0_chan_1_Descriptor_0_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_1,
        &cpuss_0_dw1_0_chan_1_Descriptor_1_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_2,
        &cpuss_0_dw1_0_chan_1_Descriptor_2_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_3,
        &cpuss_0_dw1_0_chan_1_Descriptor_3_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_4,
        &cpuss_0_dw1_0_chan_1_Descriptor_4_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_5,
        &cpuss_0_dw1_0_chan_1_Descriptor_5_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_6,
        &cpuss_0_dw1_0_chan_1_Descriptor_6_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_7,
        &cpuss_0_dw1_0_chan_1_Descriptor_7_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Descriptor_Init(
        &cpuss_0_dw1_0_chan_1_Descriptor_8,
        &cpuss_0_dw1_0_chan_1_Descriptor_8_config
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Channel_Init(
        cpuss_0_dw1_0_chan_1_HW,
        cpuss_0_dw1_0_chan_1_CHANNEL,
        &cpuss_0_dw1_0_chan_1_channelConfig
    );
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }

    // Set source addresses in the sample LUT for descriptors 0-8 to step through the samples sequentially
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_0,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 0));
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_1,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 1));
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_2,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 2));
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_3,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 3));
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_4,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 4));
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_5,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 5));
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_6,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 6));
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_7,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 7));
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_1_Descriptor_8,
                                    DMA_DESCRIPTOR_SRC_OFFSET(uint32_t, soundByteSamplesLUT, 8));
    // Set destination addresses as the CTDAC buffer register
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_0,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_1,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_2,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_3,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_4,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_5,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_6,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_7,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_1_Descriptor_8,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));

    // Initialize descriptor and channel
    dma_init_status = Cy_DMA_Descriptor_Init(&cpuss_0_dw1_0_chan_0_Descriptor_0,
                                             &cpuss_0_dw1_0_chan_0_Descriptor_0_config);
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }
    dma_init_status = Cy_DMA_Channel_Init(cpuss_0_dw1_0_chan_0_HW,
                                          cpuss_0_dw1_0_chan_0_CHANNEL,
                                          &cpuss_0_dw1_0_chan_0_channelConfig);
    if (CY_DMA_SUCCESS != dma_init_status )
    {
        CY_ASSERT(0);
    }

    // Set source address as the LUT for descriptor 0
    Cy_DMA_Descriptor_SetSrcAddress(&cpuss_0_dw1_0_chan_0_Descriptor_0,
                                    (uint32_t*) transformedSineWaveLUT); // TODO
                                    // TODO (uint32_t*) sineWaveLUT);
    // Set destination address as the CTDAC buffer register
    Cy_DMA_Descriptor_SetDstAddress(&cpuss_0_dw1_0_chan_0_Descriptor_0,
                                    (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));

    // Enable the descriptor
    Cy_DMA_Channel_Enable(cpuss_0_dw1_0_chan_0_HW, cpuss_0_dw1_0_chan_0_CHANNEL);
    Cy_DMA_Enable(cpuss_0_dw1_0_chan_0_HW);
}


void app_audio_init(void)
{
    // Initialize and start the CTDAC
    app_audio_vdac_init();
    // Initialize and start the DMA
    app_audio_dma_init(); // TODO transformedSineWaveLUT); // TODO , (uint32_t*) &(pass_0_ctdac_0_HW->CTDAC_VAL_NXT));
}

/* [] END OF FILE */